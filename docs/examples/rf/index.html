<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18.1" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="Harp Random Forests"><meta property="og:url" content="/docs/examples/rf/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - Harp Random Forests</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png" width="76%"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp/">GitHub</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/survey">Feedback</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation (single)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster">Harp Installation (cluster)</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/rf">Random Forests</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/nn">Neural Network</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/kmeans">K-means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/mfsgd">Matrix Factorization (SGD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/als">Recommender System (ALS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/svd">Singular Value Decomposition (SVD)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/pca">Principal Component Analysis (PCA)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/nn">Neural Network</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/qr">QR Decomposition (QR)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/covariance">Covariance</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/moments">Low Order Moments</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/naive_bayes">Naive Bayes</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/linear_regression">Linear Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/ridge_regression">Ridge Regression</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div><div class="panel panel-default"><section id="user-feedback" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-user-feedback" aria-labelledby="user-feedback"><i class="fa fa-caret-right"></i>User Feedback</a></h4></section><div id="collapse-user-feedback" class="panel-collapse collapse" aria-labelledby="user-feedback"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/survey">Online Survey</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>Harp Random Forests</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p><img src="https://dsc-spidal.github.io/harp/img/4-5-1.png" width="60%"  ></p>

<p>Random forests are an ensemble learning method for classification, regression and other tasks that operate by constructing a multitude of decision trees at training time and outputting the class that is the mode of the classes (classification) or mean prediction (regression) of the individual trees. Random decision forests correct for decision trees&rsquo; habit of overfitting to their training set.</p>

<p>The training algorithm for random forests applies the general technique of bootstrap aggregating, or bagging, to tree learners. Given a training set <code>X</code> with responses <code>Y</code>, bagging repeatedly selects a random sample with replacement of the training set. After training, predictions for unseen samples can be made by averaging the predictions from all the individual regression trees or by taking the majority vote in the case of decision trees. Random forests can also do another bagging &ndash; feature bagging, which is a random subset of the features. The reason for doing this is the correlation of the trees in an ordinary bootstrap sample: if one or a few features are very strong predictors for the response variable (target output), these features will be selected in many of the B trees, causing them to become correlated.</p>

<h2 id="definition">DEFINITION</h2>

<ul>
<li><code>N</code> is the number of data points</li>
<li><code>M</code> is the number of selected features</li>
<li><code>K</code> is the number of trees</li>
</ul>

<h2 id="method">METHOD</h2>

<p>The following is the procedure of Harp Random Forests training:</p>

<ol>
<li><p>Randomly select <code>N</code> samples with replacement for <code>K</code> trees (totally <code>K</code> times).</p></li>

<li><p>Select <code>M</code> features randomly which will be used in decision tree.</p></li>

<li><p>Build decision tree based on these <code>M</code> features</p></li>

<li><p>Repeat Step 2 and 3 <code>K</code> times.</p></li>
</ol>

<p>The predicting part will use these decision trees to predict <code>K</code> results. For regression, the result is the average of each tree&rsquo;s result and for classification, the majority vote will be the output.</p>

<h2 id="step-0-data-preprocessing">Step 0 &mdash; Data preprocessing</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// In the case of merging the data from different location, main process needs to create bootstrap samples.</span>
<span style="color: #75715e">// So here, the main process loads all the data and creates the bootstrap samples.</span>
<span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">doBootstrapSampling</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>                                     
    <span style="color: #75715e">//Load each of the training files under train folder                </span>
    <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">RandomForestConstants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">NUM_GLOBAL</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">files</span><span style="color: #f92672">.</span><span style="color: #a6e22e">add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainFileFolder</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">File</span><span style="color: #f92672">.</span><span style="color: #a6e22e">separator</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">trainNameFormat</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;.csv&quot;</span><span style="color: #f92672">);</span>
    <span style="color: #f92672">}</span>
    <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Loading the training data...&quot;</span><span style="color: #f92672">);</span>
    <span style="color: #f8f8f2">loadData</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainData</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">files</span><span style="color: #f92672">);</span>
    <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Data size: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">trainData</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">());</span>
    <span style="color: #f8f8f2">files</span><span style="color: #f92672">.</span><span style="color: #a6e22e">clear</span><span style="color: #f92672">();</span>
    <span style="color: #f8f8f2">ArrayList</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">Integer</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">positions</span><span style="color: #f92672">;</span>
    <span style="color: #75715e">//Create the bootstrapped samples and write to local disk</span>
    <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">RandomForestConstants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">NUM_MAPPERS</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">positions</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">DoBootStrapSampling</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainData</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">());</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Sampled data for: &quot;</span><span style="color: #f92672">+</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">+</span><span style="color: #e6db74">&quot;; size: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">positions</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">());</span>
        <span style="color: #f8f8f2">createMapperFiles</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainData</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">testData</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">fs</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">localDirStr</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">positions</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">positions</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f92672">{</span>
    <span style="color: #75715e">//Load each of the training files under train folder                </span>
    <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">RandomForestConstants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">NUM_MAPPERS</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">++){</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Loading the training data for &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;...&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">files</span><span style="color: #f92672">.</span><span style="color: #a6e22e">add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainFileFolder</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">File</span><span style="color: #f92672">.</span><span style="color: #a6e22e">separator</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">trainNameFormat</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">+</span><span style="color: #e6db74">&quot;.csv&quot;</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">loadData</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainData</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">files</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Unsampled data for: &quot;</span><span style="color: #f92672">+</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">+</span><span style="color: #e6db74">&quot;; size: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">trainData</span><span style="color: #f92672">.</span><span style="color: #a6e22e">size</span><span style="color: #f92672">());</span>
        <span style="color: #f8f8f2">createMapperFiles</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainData</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">testData</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">fs</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">localDirStr</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">,</span><span style="color: #66d9ef">null</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">files</span><span style="color: #f92672">.</span><span style="color: #a6e22e">clear</span><span style="color: #f92672">();</span>
        <span style="color: #f8f8f2">trainData</span><span style="color: #f92672">.</span><span style="color: #a6e22e">clear</span><span style="color: #f92672">();</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span> 
</pre></div>

<h2 id="step-1-train-forests">Step 1 &mdash;Train forests</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #75715e">// Create the Random Forest classifier that uses 5 neighbors to make decisions</span>
<span style="color: #f8f8f2">Classifier</span> <span style="color: #f8f8f2">rf</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">RandomForest</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">numTrees</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">numAttributes</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Random</span><span style="color: #f92672">());</span>
<span style="color: #75715e">// Learn the forest</span>
<span style="color: #f8f8f2">rf</span><span style="color: #f92672">.</span><span style="color: #a6e22e">buildClassifier</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">trainDataPoints</span><span style="color: #f92672">);</span>
</pre></div>

<h2 id="step-2-synchronize-majority-vote">Step 2 &mdash; Synchronize majority vote</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">Instance</span> <span style="color: #f8f8f2">inst</span> <span style="color: #f92672">:</span> <span style="color: #f8f8f2">testDataPoints</span><span style="color: #f92672">)</span> <span style="color: #f92672">{</span>
    <span style="color: #75715e">// This will hold this random forest&#39;s class vote for this data point</span>
    <span style="color: #75715e">//IntArray votes = IntArray.create(C, false);</span>
    <span style="color: #f8f8f2">IntArray</span> <span style="color: #f8f8f2">votes</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">IntArray</span><span style="color: #f92672">.</span><span style="color: #a6e22e">create</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">RandomForestConstants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">NUM_CLASSES</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">);</span>
    <span style="color: #75715e">// Get the prediction class from this Random Forest</span>
    <span style="color: #f8f8f2">Object</span> <span style="color: #f8f8f2">predictedClassValue</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">rf</span><span style="color: #f92672">.</span><span style="color: #a6e22e">classify</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">inst</span><span style="color: #f92672">);</span>
    <span style="color: #75715e">// Get the true value</span>
    <span style="color: #f8f8f2">Object</span> <span style="color: #f8f8f2">realClassValue</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">inst</span><span style="color: #f92672">.</span><span style="color: #a6e22e">classValue</span><span style="color: #f92672">();</span>
    <span style="color: #75715e">//int predIndex = Integer.parseInt(preds.get(dp));</span>
    <span style="color: #75715e">// Check which class was predicted</span>
    <span style="color: #66d9ef">for</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">RandomForestConstants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">NUM_CLASSES</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++)</span> <span style="color: #f92672">{</span>
        <span style="color: #75715e">// Check to see if this index matches the class that was predicted</span>
        <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">predictedClassValue</span><span style="color: #f92672">.</span><span style="color: #a6e22e">equals</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">Integer</span><span style="color: #f92672">.</span><span style="color: #a6e22e">toString</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">)))</span> <span style="color: #f92672">{</span>
            <span style="color: #75715e">// log.info(&quot;i: &quot; + i + &quot;; predictedClassValue: &quot; + predictedClassValue + &quot;; condition: &quot; + predictedClassValue.equals(Integer.toString(i)));</span>
            <span style="color: #f8f8f2">votes</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>
        <span style="color: #f92672">}</span> <span style="color: #66d9ef">else</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">votes</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>
    <span style="color: #75715e">// Add the voting results to the partition</span>
    <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">IntArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">dpP</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">IntArray</span><span style="color: #f92672">&gt;(</span><span style="color: #f8f8f2">dp</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">votes</span><span style="color: #f92672">);</span>
    <span style="color: #f8f8f2">predTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addPartition</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">dpP</span><span style="color: #f92672">);</span>
    <span style="color: #75715e">// Move onto the next data point</span>
    <span style="color: #f8f8f2">dp</span><span style="color: #f92672">++;</span>
<span style="color: #f92672">}</span>
<span style="color: #f8f8f2">log</span><span style="color: #f92672">.</span><span style="color: #a6e22e">info</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Done populating predTable\n&quot;</span><span style="color: #f92672">);</span>
<span style="color: #75715e">// All Reduce from all Mappers</span>
<span style="color: #f8f8f2">log</span><span style="color: #f92672">.</span><span style="color: #a6e22e">info</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Before allreduce!!!!&quot;</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">allreduce</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;allreduce&quot;</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">predTable</span><span style="color: #f92672">);</span>
<span style="color: #f8f8f2">log</span><span style="color: #f92672">.</span><span style="color: #a6e22e">info</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;After allreduce!!!!&quot;</span><span style="color: #f92672">);</span>
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>