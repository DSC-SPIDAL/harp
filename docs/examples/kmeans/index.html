<!DOCTYPE html><html lang="en-us"><head><link rel="shortcut icon" type="image/png" sizes="16x16" href="https://dsc-spidal.github.io/harp/img/favicon-16x9.png"><link rel="shortcut icon" type="image/png" sizes="32x32" href="https://dsc-spidal.github.io/harp/img/favicon-32x18.png"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="generator" content="Hugo 0.18" /><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="harp"><meta property="og:image" content="/img/logo54x54.png"><meta property="og:url" content="https://dsc-spidal.github.io/harp/"><meta name="twitter:title" content="harp"><meta name="twitter:image" content="/img/0-1-1.png"><meta property="og:site_name" content="K-Means"><meta property="og:url" content="/docs/examples/kmeans/"><meta property="og:description" content=""><meta name="twitter:description" content=""><title>harp Documentation - K-Means</title><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/style.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/font-awesome.min.css"><link rel="stylesheet" href="https://dsc-spidal.github.io/harp/css/pygments.css"></head><body><nav class="hn-top-navbar navbar navbar-inverse navbar-fixed-top" role="navigation"><div class="hn-navbar-container container-fluid"><div class="navbar-header"><button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#hn-navbar" aria-controls="hn-navbar" aria-expanded="false"><span class="sr-only"><Toggle>navigation</Toggle></span><i class="hn-toggle-button fa fa-bars"></i></button><a class="hn-navbar-logo navbar-brand" href="https://dsc-spidal.github.io/harp/"><img class="pull-left" src="https://dsc-spidal.github.io/harp/img/0-1-2.png"></a></div><div id="hn-navbar" class="navbar-collapse collapse"><ul class="nav navbar-nav navbar-right"><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Docs</a></li><li><a href="https://dsc-spidal.github.io/harp/api">API</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Resources</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://github.com/DSC-SPIDAL/harp/">GitHub</a></li><li><a href="https://groups.google.com/forum/#!forum/harp-users">Mailing List</a></li></ul></div></div></nav><div class="hn-main"><div class="container"><div class="row"><aside class="hn-sidebar hidden-xs col-sm-4 col-md-3 col-lg-2 collapse"><nav class="hn-sidebar-nav"><div id="hn-accordion" class="panel-group" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><section id="quick-start" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-quick-start" aria-labelledby="quick-start"><i class="fa fa-caret-right"></i>Quick Start</a></h4></section><div id="collapse-quick-start" class="panel-collapse collapse" aria-labelledby="quick-start"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started">Harp Installation (single)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/getting-started-cluster">Harp Installation (cluster)</a></li></ul></div></div></div><div class="panel panel-default"><section id="programming-guides" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-programming-guides" aria-labelledby="programming-guides"><i class="fa fa-caret-right"></i>Programming Guides</a></h4></section><div id="collapse-programming-guides" class="panel-collapse collapse" aria-labelledby="programming-guides"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/programming/overview">Overview</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/data-interface">Data Interfaces and Types</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/scheduler">Schedulers</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/programming/computation-models">Computation Models</a></li></ul></div></div></div><div class="panel panel-default"><section id="collective-communication" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-collective-communication" aria-labelledby="collective-communication"><i class="fa fa-caret-right"></i>Collective Communication</a></h4></section><div id="collapse-collective-communication" class="panel-collapse collapse" aria-labelledby="collective-communication"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/communications/broadcast">broadcast</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/reduce">reduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allgather">allgather</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/allreduce">allreduce</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/regroup">regroup</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/pushandpull">push &amp; pull</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/communications/rotate">rotate</a></li></ul></div></div></div><div class="panel panel-default"><section id="examples" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-examples" aria-labelledby="examples"><i class="fa fa-caret-right"></i>Examples</a></h4></section><div id="collapse-examples" class="panel-collapse collapse" aria-labelledby="examples"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/examples/kmeans">K-Means</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/mlrsgd">Multiclass Logistic Regression</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/lda">Latent Dirichlet Allocation (CVB)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/svm">Support Vector Machine</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/examples/rf">Random Forests</a></li></ul></div></div></div><div class="panel panel-default"><section id="applications" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-applications" aria-labelledby="applications"><i class="fa fa-caret-right"></i>Applications</a></h4></section><div id="collapse-applications" class="panel-collapse collapse" aria-labelledby="applications"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/applications/lda-cgs">Latent Dirichlet Allocation (CGS)</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/applications/mf">Matrix Factorization</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-daal" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-daal" aria-labelledby="harp-daal"><i class="fa fa-caret-right"></i>Harp-DAAL</a></h4></section><div id="collapse-harp-daal" class="panel-collapse collapse" aria-labelledby="harp-daal"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/harpdaal">Harp-DAAL</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/harpdaal/Example">Example</a></li></ul></div></div></div><div class="panel panel-default"><section id="harp-resources" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-harp-resources" aria-labelledby="harp-resources"><i class="fa fa-caret-right"></i>Harp Resources</a></h4></section><div id="collapse-harp-resources" class="panel-collapse collapse" aria-labelledby="harp-resources"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/resources">Harp Resources</a></li></ul></div></div></div><div class="panel panel-default"><section id="contributors" class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#hn-accordion" href="#collapse-contributors" aria-labelledby="contributors"><i class="fa fa-caret-right"></i>Contributors</a></h4></section><div id="collapse-contributors" class="panel-collapse collapse" aria-labelledby="contributors"><div class="panel-body"><ul><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/community">Community</a></li><li><a href="https://dsc-spidal.github.io/harp/docs/contributors/contributors">Contributors</a></li></ul></div></div></div></div></nav></aside><section class="hn-docs-main col-sm-8 col-md-9 col-lg-10 col-sm-offset-4 col-md-offset-3 col-lg-offset-2"><header class="hn-docs-header page-header"><h1>K-Means</h1><div class="hn-docs-description"></div></header><article class="hn-docs-content">

<p><img src="https://dsc-spidal.github.io/harp/img/kmeans.png" width="80%" ></p>

<p>K-Means is a very powerful and easily understood clustering algorithm. The aim of the algorithm is to divide a given set of points into <code>K</code> partitions. <code>K</code> needs to be specified by the user. In order to understand K-Means, first you need to understand the proceeding concepts and their meaning.</p>

<ul>
<li><p><code>Centroids</code>:
Centroids can be defined as the center of each cluster. If we are performing clustering with k=3, we will have 3 centroids. To perform K-Means clustering, the users needs to provide the initial set of centroids.</p></li>

<li><p><code>Distance</code>:
In order to group data points as close together or as far-apart we need to define a distance between two given data points. In K-Means clustering distance is normally calculated as the Euclidean Distance between two data points.</p></li>
</ul>

<p>The K-Means algorithm simply repeats the following set of steps until there is no change in the partition assignments, in that it has clarified which data point is assigned to which partition.</p>

<ol>
<li><p>Choose K points as the initial set of centroids.</p></li>

<li><p>Assign each data point in the data set to the closest centroid (this is done by calculating the distance between the data point and each centroid).</p></li>

<li><p>Calculate the new centroids based on the clusters that were generated in step 2. Normally this is done by calculating the mean of each cluster.</p></li>

<li><p>Repeat steps 2 and 3 until data points do not change cluster assignments, meaning their centroids are set.</p></li>
</ol>

<h2 id="step-1-the-main-method">Step 1 &mdash; The Main Method</h2>

<p>The tasks of the main class is to configure and run the job iteratively.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">generate</span> <span style="color: #f8f8f2">N</span> <span style="color: #f8f8f2">data</span> <span style="color: #a6e22e">points</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">D</span> <span style="color: #f8f8f2">dimensions</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">write</span> <span style="color: #f8f8f2">to</span> <span style="color: #f8f8f2">HDFS</span>
<span style="color: #f8f8f2">generate</span> <span style="color: #f8f8f2">M</span> <span style="color: #f8f8f2">centroids</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">write</span> <span style="color: #f8f8f2">to</span> <span style="color: #f8f8f2">HDFS</span>
<span style="color: #66d9ef">for</span> <span style="color: #f8f8f2">iterations</span><span style="color: #f92672">{</span>
    <span style="color: #f8f8f2">configure</span> <span style="color: #f8f8f2">a</span> <span style="color: #f8f8f2">job</span>
    <span style="color: #f8f8f2">launch</span> <span style="color: #f8f8f2">the</span> <span style="color: #f8f8f2">job</span>
<span style="color: #f92672">}</span>
</pre></div>

<h2 id="step-2-the-mapcollective-function">Step 2 &mdash; The mapCollective function</h2>

<p>This is the definition of map-collective task. It reads data from context and then call runKmeans function to actually run kmeans Mapper task.</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">protected</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">mapCollective</span><span style="color: #f92672">(</span> <span style="color: #f8f8f2">KeyValReader</span> <span style="color: #f8f8f2">reader</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Context</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">InterruptedException</span> <span style="color: #f92672">{</span>
    <span style="color: #f8f8f2">LOG</span><span style="color: #f92672">.</span><span style="color: #a6e22e">info</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Start collective mapper.&quot;</span><span style="color: #f92672">);</span>
    <span style="color: #66d9ef">long</span> <span style="color: #f8f8f2">startTime</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">();</span>
    <span style="color: #f8f8f2">List</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">pointFiles</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">ArrayList</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">&gt;();</span>
    <span style="color: #66d9ef">while</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">reader</span><span style="color: #f92672">.</span><span style="color: #a6e22e">nextKeyValue</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
	   	<span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">key</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">reader</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getCurrentKey</span><span style="color: #f92672">();</span>
	   	<span style="color: #f8f8f2">String</span> <span style="color: #f8f8f2">value</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">reader</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getCurrentValue</span><span style="color: #f92672">();</span>
    	<span style="color: #f8f8f2">LOG</span><span style="color: #f92672">.</span><span style="color: #a6e22e">info</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Key: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">key</span> <span style="color: #f92672">+</span> <span style="color: #e6db74">&quot;, Value: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f8f8f2">value</span><span style="color: #f92672">);</span>
	    <span style="color: #f8f8f2">pointFiles</span><span style="color: #f92672">.</span><span style="color: #a6e22e">add</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">value</span><span style="color: #f92672">);</span>
	<span style="color: #f92672">}</span>
	<span style="color: #f8f8f2">Configuration</span> <span style="color: #f8f8f2">conf</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getConfiguration</span><span style="color: #f92672">();</span>
	<span style="color: #f8f8f2">runKmeans</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">pointFiles</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">);</span>
    <span style="color: #f8f8f2">LOG</span><span style="color: #f92672">.</span><span style="color: #a6e22e">info</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Total iterations in master view: &quot;</span> <span style="color: #f92672">+</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">currentTimeMillis</span><span style="color: #f92672">()</span> <span style="color: #f92672">-</span> <span style="color: #f8f8f2">startTime</span><span style="color: #f92672">));</span>
<span style="color: #f92672">}</span>
</pre></div>

<h2 id="step-3-the-runkmeans-function">Step 3 &mdash; The runKmeans function</h2>

<p>Harp provides several collective communication operations. Here are some examples provided to show how to apply these collective communication methods to K-Means.</p>

<p><ul class="nav nav-pills">
    <li class="active"><a data-toggle="pill" href="#allreduce">Allreduce</a></li>
    <li><a data-toggle="pill" href="#broadcast-reduce">Broadcast-Reduce</a></li>
    <li><a data-toggle="pill" href="#push-pull">Push-Pull</a></li>
    <li><a data-toggle="pill" href="#regroup-allgather">Regroup-Allgather</a></li>
  </ul></p>

<p><div class="tab-content">
    <div id="allreduce" class="tab-pane fade in active">
      <h4>Use AllReduce collective communication to do synchronization</h4>
      <div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">runKmeans</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">List</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">fileNames</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Configuration</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Context</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
      <span style="color: #75715e">// &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</span>
      <span style="color: #75715e">// Load centroids</span>
      <span style="color: #75715e">//for every partition in the centoid table, we will use the last element to store the number of points </span>
      <span style="color: #75715e">// which are clustered to the particular partitionID</span>
      <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">cenTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
      <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
            <span style="color: #f8f8f2">loadCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">KMeansConstants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">CFILE</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
      <span style="color: #f92672">}</span>
      <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;After loading centroids&quot;</span><span style="color: #f92672">);</span>
      <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
      <span style="color: #75715e">//broadcast centroids</span>
      <span style="color: #f8f8f2">broadcastCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
      <span style="color: #75715e">//after broadcasting</span>
      <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;After brodcasting centroids&quot;</span><span style="color: #f92672">);</span>
      <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
      <span style="color: #75715e">//load data </span>
      <span style="color: #f8f8f2">ArrayList</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">dataPoints</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">loadData</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">fileNames</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
      <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">previousCenTable</span> <span style="color: #f92672">=</span>  <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
      <span style="color: #75715e">//iterations</span>
      <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">iter</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">iter</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">iteration</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">iter</span><span style="color: #f92672">++){</span>
            <span style="color: #f8f8f2">previousCenTable</span> <span style="color: #f92672">=</span>  <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">;</span>
            <span style="color: #f8f8f2">cenTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
            <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Iteraton No.&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">);</span>
            <span style="color: #75715e">//compute new partial centroid table using previousCenTable and data points</span>
            <span style="color: #f8f8f2">computation</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">previousCenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">dataPoints</span><span style="color: #f92672">);</span>
            <span style="color: #75715e">//AllReduce; </span>
            <span style="color: #75715e">/*************************************<strong><em>/</span>
            <span style="color: #f8f8f2">allreduce</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;allreduce_&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
            <span style="color: #75715e">//we can calculate new centroids</span>
            <span style="color: #f8f8f2">calculateCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
            <span style="color: #75715e">/</em></strong>*************************************/</span>
            <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
        <span style="color: #f92672">}</span>
        <span style="color: #75715e">//output results</span>
     <span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">()){</span>
        <span style="color: #f8f8f2">outputCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span>  <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span>   <span style="color: #f8f8f2">context</span><span style="color: #f92672">);</span>
      <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
 </pre></div>
    </div>
    <div id="broadcast-reduce" class="tab-pane fade">
      <h4>Use broadcast and reduce collective communication to do synchronization</h4></p>

<p>The video below is the step by step guide on how this collective communication works for K-means. The data is partitions into K different partitions with K centroids. Data is then broadcasted to all the different partitions. And the centroids for each of the partition is grouped together and sent to the master node.</p>

<p><p>Once all the local centroids from the partition is collected in the global centroid table, the updated table is transferred to the root node and then broadcasted again. This step keeps repeating itself till the convergence is reached.
</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">runKmeans</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">List</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">fileNames</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Configuration</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Context</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
     <span style="color: #75715e">// &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</span>
     <span style="color: #75715e">// Load centroids</span>
     <span style="color: #75715e">//for every partition in the centoid table, we will use the last element to store the number of points </span>
     <span style="color: #75715e">// which are clustered to the particular partitionID</span>
     <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">cenTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
     <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
        <span style="color: #f8f8f2">loadCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">KMeansConstants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">CFILE</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
     <span style="color: #f92672">}</span>
     <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;After loading centroids&quot;</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
     <span style="color: #75715e">//broadcast centroids</span>
     <span style="color: #f8f8f2">broadcastCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
     <span style="color: #75715e">//after broadcasting</span>
     <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;After brodcasting centroids&quot;</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
     <span style="color: #75715e">//load data </span>
     <span style="color: #f8f8f2">ArrayList</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">dataPoints</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">loadData</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">fileNames</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
     <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">previousCenTable</span> <span style="color: #f92672">=</span>  <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
     <span style="color: #75715e">//iterations</span>
     <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">iter</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">iter</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">iteration</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">iter</span><span style="color: #f92672">++){</span>
        <span style="color: #f8f8f2">previousCenTable</span> <span style="color: #f92672">=</span>  <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">;</span>
        <span style="color: #f8f8f2">cenTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
        <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Iteraton No.&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">);</span>
        <span style="color: #75715e">//compute new partial centroid table using previousCenTable and data points</span>
        <span style="color: #f8f8f2">computation</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">previousCenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">dataPoints</span><span style="color: #f92672">);</span>
        <span style="color: #75715e">/*************************************<strong><em>/</span>
        <span style="color: #f8f8f2">reduce</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;reduce<em>&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getMasterID</span><span style="color: #f92672">());</span>
        <span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">())</span>
            <span style="color: #f8f8f2">calculateCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
        <span style="color: #f8f8f2">broadcast</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;bcast</em>&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getMasterID</span><span style="color: #f92672">(),</span> <span style="color: #66d9ef">false</span><span style="color: #f92672">);</span>
        <span style="color: #75715e">/</em></strong>**********************************<strong><em>/</span>
        <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
    <span style="color: #f92672">}</span>
        <span style="color: #75715e">//output results</span>
    <span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">()){</span>
        <span style="color: #f8f8f2">outputCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span>  <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span>   <span style="color: #f8f8f2">context</span><span style="color: #f92672">);</span>
    <span style="color: #f92672">}</span>
<span style="color: #f92672">}</span>
     </pre></div>
     </div>
    <div id="push-pull" class="tab-pane fade">
      <h4>Use push and pull collective communication to do synchronization</h4>
    <div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">runKmeans</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">List</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">fileNames</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Configuration</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Context</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
          <span style="color: #75715e">// &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</span>
          <span style="color: #75715e">// Load centroids</span>
          <span style="color: #75715e">//for every partition in the centoid table, we will use the last element to store the number of points </span>
          <span style="color: #75715e">// which are clustered to the particular partitionID</span>
          <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">cenTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
          <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
              <span style="color: #f8f8f2">loadCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">KMeansConstants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">CFILE</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
          <span style="color: #f92672">}</span>
          <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;After loading centroids&quot;</span><span style="color: #f92672">);</span>
          <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
          <span style="color: #75715e">//broadcast centroids</span>
          <span style="color: #f8f8f2">broadcastCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
          <span style="color: #75715e">//after broadcasting</span>
          <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;After brodcasting centroids&quot;</span><span style="color: #f92672">);</span>
          <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
          <span style="color: #75715e">//load data </span>
          <span style="color: #f8f8f2">ArrayList</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">dataPoints</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">loadData</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">fileNames</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
          <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">globalTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span>  <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
          <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">previousCenTable</span> <span style="color: #f92672">=</span>  <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
          <span style="color: #75715e">//iterations</span>
          <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">iter</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">iter</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">iteration</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">iter</span><span style="color: #f92672">++){</span>
              <span style="color: #75715e">// clean contents in the table.</span>
              <span style="color: #f8f8f2">globalTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">release</span><span style="color: #f92672">();</span>
              <span style="color: #f8f8f2">previousCenTable</span> <span style="color: #f92672">=</span>  <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">;</span>
              <span style="color: #f8f8f2">cenTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
              <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Iteraton No.&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">);</span>
              <span style="color: #75715e">//compute new partial centroid table using previousCenTable and data points</span>
              <span style="color: #f8f8f2">computation</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">previousCenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">dataPoints</span><span style="color: #f92672">);</span>
              <span style="color: #75715e">/</em></strong>**********************************<strong><em>/</span>
              <span style="color: #f8f8f2">push</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;push<em>&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">globalTable</span> <span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Partitioner</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getNumWorkers</span><span style="color: #f92672">()));</span>
              <span style="color: #75715e">//we can calculate new centroids</span>
              <span style="color: #f8f8f2">calculateCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">globalTable</span><span style="color: #f92672">);</span>
              <span style="color: #f8f8f2">pull</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;pull</em>&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">globalTable</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">true</span><span style="color: #f92672">);</span>
              <span style="color: #75715e">/</em></strong>**********************************<strong><em>/</span>
              <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
          <span style="color: #f92672">}</span>
          <span style="color: #75715e">//output results</span>
          <span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">()){</span>
              <span style="color: #f8f8f2">outputCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span>  <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span>   <span style="color: #f8f8f2">context</span><span style="color: #f92672">);</span>
          <span style="color: #f92672">}</span>
     <span style="color: #f92672">}</span>
</pre></div>
    </div>
    <div id="regroup-allgather" class="tab-pane fade">
      <h3>Use Regroup and allgather collective communication to do synchronization</h3>
    <div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">runKmeans</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">List</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">String</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">fileNames</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Configuration</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Context</span> <span style="color: #f8f8f2">context</span><span style="color: #f92672">)</span> <span style="color: #66d9ef">throws</span> <span style="color: #f8f8f2">IOException</span> <span style="color: #f92672">{</span>
          <span style="color: #75715e">// &mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</span>
          <span style="color: #75715e">// Load centroids</span>
          <span style="color: #75715e">//for every partition in the centoid table, we will use the last element to store the number of points </span>
          <span style="color: #75715e">// which are clustered to the particular partitionID</span>
          <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">cenTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
          <span style="color: #66d9ef">if</span> <span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">())</span> <span style="color: #f92672">{</span>
              <span style="color: #f8f8f2">loadCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">KMeansConstants</span><span style="color: #f92672">.</span><span style="color: #a6e22e">CFILE</span><span style="color: #f92672">),</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
          <span style="color: #f92672">}</span>
          <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;After loading centroids&quot;</span><span style="color: #f92672">);</span>
          <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
          <span style="color: #75715e">//broadcast centroids</span>
          <span style="color: #f8f8f2">broadcastCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
          <span style="color: #75715e">//after broadcasting</span>
          <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;After brodcasting centroids&quot;</span><span style="color: #f92672">);</span>
          <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
          <span style="color: #75715e">//load data </span>
          <span style="color: #f8f8f2">ArrayList</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">dataPoints</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">loadData</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">fileNames</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">conf</span><span style="color: #f92672">);</span>
          <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">previousCenTable</span> <span style="color: #f92672">=</span>  <span style="color: #66d9ef">null</span><span style="color: #f92672">;</span>
          <span style="color: #75715e">//iterations</span>
          <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">iter</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">iter</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">iteration</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">iter</span><span style="color: #f92672">++){</span>
              <span style="color: #f8f8f2">previousCenTable</span> <span style="color: #f92672">=</span>  <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">;</span>
              <span style="color: #f8f8f2">cenTable</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;&gt;(</span><span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArrPlus</span><span style="color: #f92672">());</span>
              <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Iteraton No.&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">);</span>
              <span style="color: #75715e">//compute new partial centroid table using previousCenTable and data points</span>
              <span style="color: #f8f8f2">computation</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">previousCenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">dataPoints</span><span style="color: #f92672">);</span>
              <span style="color: #75715e">/</em></strong>**********************************<strong><em>/</span>
              <span style="color: #75715e">//regroup and allgather to synchronized centroids</span>
              <span style="color: #f8f8f2">regroup</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;regroup<em>&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">);</span>
              <span style="color: #75715e">//we can calculate new centroids</span>
              <span style="color: #f8f8f2">calculateCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
              <span style="color: #f8f8f2">allgather</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;main&quot;</span><span style="color: #f92672">,</span> <span style="color: #e6db74">&quot;allgather</em>&quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">iter</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
              <span style="color: #75715e">/</em></strong>*************************************/</span>
              <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
          <span style="color: #f92672">}</span>
          <span style="color: #75715e">//output results</span>
          <span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #66d9ef">this</span><span style="color: #f92672">.</span><span style="color: #a6e22e">isMaster</span><span style="color: #f92672">()){</span>
              <span style="color: #f8f8f2">outputCentroids</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span>  <span style="color: #f8f8f2">conf</span><span style="color: #f92672">,</span>   <span style="color: #f8f8f2">context</span><span style="color: #f92672">);</span>
          <span style="color: #f92672">}</span>
     <span style="color: #f92672">}</span>
</pre></div>
   </div>
  </div></p>

<h2 id="step-4-compute-local-centroids">Step 4 &mdash; Compute local centroids</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">computation</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">previousCenTable</span><span style="color: #f92672">,</span><span style="color: #f8f8f2">ArrayList</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">dataPoints</span><span style="color: #f92672">){</span>
    <span style="color: #66d9ef">double</span> <span style="color: #f8f8f2">err</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
    <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">DoubleArray</span> <span style="color: #f8f8f2">aPoint</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">dataPoints</span><span style="color: #f92672">){</span>
    <span style="color: #75715e">//for each data point, find the nearest centroid</span>
        <span style="color: #66d9ef">double</span> <span style="color: #f8f8f2">minDist</span> <span style="color: #f92672">=</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">double</span> <span style="color: #f8f8f2">tempDist</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">nearestPartitionID</span> <span style="color: #f92672">=</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>
        <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">Partition</span> <span style="color: #f8f8f2">ap</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">previousCenTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getPartitions</span><span style="color: #f92672">()){</span>
            <span style="color: #f8f8f2">DoubleArray</span> <span style="color: #f8f8f2">aCentroid</span> <span style="color: #f92672">=</span> <span style="color: #f92672">(</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">)</span> <span style="color: #f8f8f2">ap</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">();</span>
            <span style="color: #f8f8f2">tempDist</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">calcEucDistSquare</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">aPoint</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">aCentroid</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">);</span>
            <span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">minDist</span> <span style="color: #f92672">==</span> <span style="color: #f92672">-</span><span style="color: #ae81ff">1</span> <span style="color: #f92672">||</span> <span style="color: #f8f8f2">tempDist</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">minDist</span><span style="color: #f92672">){</span>
                <span style="color: #f8f8f2">minDist</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">tempDist</span><span style="color: #f92672">;</span>
                <span style="color: #f8f8f2">nearestPartitionID</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">ap</span><span style="color: #f92672">.</span><span style="color: #a6e22e">id</span><span style="color: #f92672">();</span>
            <span style="color: #f92672">}</span>
        <span style="color: #f92672">}</span>
        <span style="color: #f8f8f2">err</span><span style="color: #f92672">+=</span><span style="color: #f8f8f2">minDist</span><span style="color: #f92672">;</span>

        <span style="color: #75715e">//for the certain data point, found the nearest centroid.</span>
        <span style="color: #75715e">// add the data to a new cenTable.</span>
        <span style="color: #66d9ef">double</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">partial</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #66d9ef">double</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">+</span><span style="color: #ae81ff">1</span><span style="color: #f92672">];</span>
        <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">j</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">j</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">j</span><span style="color: #f92672">++){</span>
            <span style="color: #f8f8f2">partial</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">aPoint</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #f8f8f2">j</span><span style="color: #f92672">];</span>
        <span style="color: #f92672">}</span>
        <span style="color: #f8f8f2">partial</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">]=</span><span style="color: #ae81ff">1</span><span style="color: #f92672">;</span>

        <span style="color: #66d9ef">if</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getPartition</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">nearestPartitionID</span><span style="color: #f92672">)</span> <span style="color: #f92672">==</span> <span style="color: #66d9ef">null</span><span style="color: #f92672">){</span>
            <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">tmpAp</span> <span style="color: #f92672">=</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;(</span><span style="color: #f8f8f2">nearestPartitionID</span><span style="color: #f92672">,</span> <span style="color: #66d9ef">new</span> <span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">partial</span><span style="color: #f92672">,</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">,</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">+</span><span style="color: #ae81ff">1</span><span style="color: #f92672">));</span>
            <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">addPartition</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">tmpAp</span><span style="color: #f92672">);</span>
        <span style="color: #f92672">}</span><span style="color: #66d9ef">else</span><span style="color: #f92672">{</span>
             <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">apInCenTable</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getPartition</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">nearestPartitionID</span><span style="color: #f92672">);</span>
             <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">=</span><span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">vectorSize</span> <span style="color: #f92672">+</span><span style="color: #ae81ff">1</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">i</span><span style="color: #f92672">++){</span>
             <span style="color: #f8f8f2">apInCenTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">().</span><span style="color: #a6e22e">get</span><span style="color: #f92672">()[</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">]</span> <span style="color: #f92672">+=</span> <span style="color: #f8f8f2">partial</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">i</span><span style="color: #f92672">];</span>
             <span style="color: #f92672">}</span>
        <span style="color: #f92672">}</span>
    <span style="color: #f92672">}</span>
    <span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;Errors: &quot;</span><span style="color: #f92672">+</span><span style="color: #f8f8f2">err</span><span style="color: #f92672">);</span>
<span style="color: #f92672">}</span>
</pre></div>

<h2 id="step-5-calculate-new-centroids">Step 5 &mdash; Calculate new centroids</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #66d9ef">private</span> <span style="color: #66d9ef">void</span> <span style="color: #a6e22e">calculateCentroids</span><span style="color: #f92672">(</span> <span style="color: #f8f8f2">Table</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">){</span>
    <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span> <span style="color: #f8f8f2">Partition</span><span style="color: #f92672">&lt;</span><span style="color: #f8f8f2">DoubleArray</span><span style="color: #f92672">&gt;</span> <span style="color: #f8f8f2">partialCenTable</span><span style="color: #f92672">:</span> <span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">getPartitions</span><span style="color: #f92672">()){</span>
        <span style="color: #66d9ef">double</span><span style="color: #f92672">[]</span> <span style="color: #f8f8f2">doubles</span> <span style="color: #f92672">=</span> <span style="color: #f8f8f2">partialCenTable</span><span style="color: #f92672">.</span><span style="color: #a6e22e">get</span><span style="color: #f92672">().</span><span style="color: #a6e22e">get</span><span style="color: #f92672">();</span>
        <span style="color: #66d9ef">for</span><span style="color: #f92672">(</span><span style="color: #66d9ef">int</span> <span style="color: #f8f8f2">h</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">h</span> <span style="color: #f92672">&lt;</span> <span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">;</span> <span style="color: #f8f8f2">h</span><span style="color: #f92672">++){</span>
            <span style="color: #f8f8f2">doubles</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">h</span><span style="color: #f92672">]</span> <span style="color: #f92672">/=</span> <span style="color: #f8f8f2">doubles</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">];</span>
        <span style="color: #f92672">}</span>
        <span style="color: #f8f8f2">doubles</span><span style="color: #f92672">[</span><span style="color: #f8f8f2">vectorSize</span><span style="color: #f92672">]</span> <span style="color: #f92672">=</span> <span style="color: #ae81ff">0</span><span style="color: #f92672">;</span>
	<span style="color: #f92672">}</span>
	<span style="color: #f8f8f2">System</span><span style="color: #f92672">.</span><span style="color: #a6e22e">out</span><span style="color: #f92672">.</span><span style="color: #a6e22e">println</span><span style="color: #f92672">(</span><span style="color: #e6db74">&quot;after calculate new centroids&quot;</span><span style="color: #f92672">);</span>
    <span style="color: #f8f8f2">printTable</span><span style="color: #f92672">(</span><span style="color: #f8f8f2">cenTable</span><span style="color: #f92672">);</span>
<span style="color: #f92672">}</span>
</pre></div>

<h2 id="compile">COMPILE</h2>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span><span style="color: #f8f8f2">cd</span> <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>
mvn clean package
<span style="color: #f8f8f2">cd</span> <span style="color: #f8f8f2">$HARP_ROOT_DIR</span>/harp-tutorial-app
cp target/harp-tutorial-app-1.0-SNAPSHOT.jar <span style="color: #f8f8f2">$HADOOP_HOME</span>
<span style="color: #f8f8f2">cd</span> <span style="color: #f8f8f2">$HADOOP_HOME</span>
</pre></div>

<h2 id="usage">USAGE</h2>

<p>Run Harp K-Means:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>hadoop jar harp-tutorial-app-1.0-SNAPSHOT.jar edu.iu.kmeans.common.KmeansMapCollective &lt;numOfDataPoints&gt; &lt;num of Centroids&gt; &lt;size of vector&gt; &lt;number of map tasks&gt; &lt;number of iteration&gt; &lt;workDir&gt; &lt;localDir&gt; &lt;communication operation&gt;

   &lt;numOfDataPoints&gt;: the number of data points you want to generate randomly
   &lt;num of centriods&gt;: the number of centroids you want to clustering the data to
   &lt;size of vector&gt;: the number of dimension of the data
   &lt;number of map tasks&gt;: number of map tasks
   &lt;number of iteration&gt;: the number of iterations to run
   &lt;work dir&gt;: the root directory <span style="color: #66d9ef">for</span> this running in HDFS
   &lt;<span style="color: #f8f8f2">local</span> dir&gt;: the harp kmeans will firstly generate files which contain data points to <span style="color: #f8f8f2">local</span> directory. Set this argument to determine the <span style="color: #f8f8f2">local</span> directory.
   &lt;communication operation&gt; includes:
		<span style="color: #f92672">[</span>allreduce<span style="color: #f92672">]</span>: use allreduce operation to synchronize centroids
		<span style="color: #f92672">[</span>regroup-allgather<span style="color: #f92672">]</span>: use regroup and allgather operation to synchronize centroids
		<span style="color: #f92672">[</span>broadcast-reduce<span style="color: #f92672">]</span>: use broadcast and reduce operation to synchronize centroids
		<span style="color: #f92672">[</span>push-pull<span style="color: #f92672">]</span>: use push and pull operation to synchronize centroids
</pre></div>

<p>For example:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>hadoop jar harp-tutorial-app-1.0-SNAPSHOT.jar edu.iu.kmeans.common.KmeansMapCollective <span style="color: #ae81ff">1000</span> <span style="color: #ae81ff">10</span> <span style="color: #ae81ff">10</span> <span style="color: #ae81ff">2</span> <span style="color: #ae81ff">10</span> /kmeans /tmp/kmeans allreduce
</pre></div>

<p>Fetch the results:</p>
<div class="highlight" style="background: #272822"><pre style="line-height: 125%"><span></span>hdfs dfs -ls /
hdfs dfs -cat /kmeans/centroids/*
</pre></div>
</article></section></div></div></div><script src="https://code.jquery.com/jquery-2.2.1.min.js"></script><script src="https://dsc-spidal.github.io/harp/js/app.min.js"></script></body></html>